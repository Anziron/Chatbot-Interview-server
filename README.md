# 智能对话助手系统

## 项目概述

本项目是一个多功能智能对话系统，基于大型语言模型(LLM)构建，集成了多种智能代理和工具，可以处理包括但不限于文档处理、图像生成、邮件发送等多种任务。系统支持检索增强生成(RAG)技术、联网搜索以及智能工作流管理，提供了丰富的API接口供前端调用。

## 主要功能

### 智能代理系统

- **基础对话代理**：提供核心问答功能，支持推理过程展示
- **图像邮件代理**：处理图像相关的邮件任务
- **发票提取代理**：自动识别和提取发票中的关键信息
- **会议记录代理**：处理会议记录，提取关键信息
- **简历分析代理**：分析简历内容，生成问题和标准答案
- **摘要生成代理**：根据文本内容生成摘要信息

### 知识检索系统

- **向量存储**：使用FAISS实现高效的向量存储和检索
- **文本切片**：支持递归字符切片，适合中英文混合内容
- **批量搜索**：支持对多个问题进行批量检索
- **高性能索引**：同时支持标准FAISS和HNSW索引，优化检索性能

### 面试系统

- **简历上传**：支持上传简历并自动分析
- **智能问答**：根据简历内容生成针对性的面试问题
- **评分系统**：对面试回答进行自动评分和分析
- **PDF报告**：生成详细的面试评估报告

### 核心工具

#### 文档处理工具

- **PDF处理**：支持PDF文档的读取和生成
- **Excel处理**：处理Excel文件的读写和数据提取
- **文档识别**：识别发票和会议记录等特定类型文档

#### 通信工具

- **邮件发送**：支持发送包含文本和图像的电子邮件
- **飞书集成**：与飞书平台集成，支持消息推送

#### 多媒体工具

- **图像生成**：支持AI图像生成功能
- **网络搜索**：提供实时网络搜索能力

## 技术架构

### 核心组件

- **模型层**：基于阿里云通义千问系列模型(qwen-plus/qwen-max)
- **工作流引擎**：使用LangGraph构建可持久化的工作流
- **向量数据库**：使用FAISS实现高性能向量存储
- **API框架**：基于FastAPI构建高性能API接口

### 数据流程

1. 用户请求通过API进入系统
2. 工作流引擎(`_workflow/_work.py`)接收并处理请求
3. 系统首先尝试从缓存中检索答案
4. 如果缓存未命中，则调用对应的智能代理处理
5. 代理根据需要调用各种工具(RAG搜索、网络搜索等)
6. 处理结果返回给用户，同时写入缓存供后续使用

### 容错机制

- **模型调用重试**：自动处理模型调用超时和连接错误
- **优雅降级**：当主模型不可用时，自动切换到备用模型
- **异常处理**：完善的异常捕获和日志记录机制

## Web界面

系统提供了以下Web页面:

- **首页**：主要功能入口(`/`)
- **知识库页面**：管理和查询知识库(`/rag`)
- **面试页面**：进行智能面试评估(`/interview`)

## API接口

### 对话API

- **POST `/chat`**：主要的对话接口，支持启用联网和推理展示
- **POST `/delete_thread_memory`**：删除特定会话的记忆数据
- **GET `/health`**：健康检查接口

### 知识库API

- **POST `/upload`**：上传文件到知识库
- **POST `/search`**：搜索知识库
- **POST `/batch_search`**：批量搜索知识库
- **POST `/delete`**：删除知识库中的文件
- **GET `/files`**：获取知识库中的文件列表

### 面试API

- **POST `/interview/upload-resume/`**：上传简历并开始面试流程
- **GET `/interview/question/`**：获取面试问题
- **POST `/interview/answer/`**：提交面试回答
- **POST `/interview/ai-answer/`**：获取AI生成的参考回答
- **GET `/interview/report/{session_id}`**：获取面试评估报告

### 智能代理API

- **POST `/upload_image`**：上传图像文件
- **POST `/agents/image_mailer`**：调用图像邮件代理
- **POST `/agents/invoice_extractor`**：调用发票提取代理
- **POST `/agents/meeting_notes`**：调用会议记录代理

## 使用方法

### 环境准备

系统依赖Python 3.8+环境，需要配置以下环境变量:

- `DASHSCOPE_API_KEY`: 阿里云通义千问API密钥

### 安装依赖

```bash
pip install -r requirements.txt
```

### 启动服务

```bash
python main.py
```

服务启动后会自动打开浏览器访问http://127.0.0.1:8000

### 缓存和状态

- 系统会自动创建以下目录:
  - `_cache/cache_database`: 存储缓存数据
  - `exports`: 存储导出的文件
  - `uploads`: 存储上传的文件
  - `_tools/_rag/vector_store`: 存储向量数据库

## 性能优化

- 使用LRU缓存加速向量库加载
- 支持HNSW索引提升检索效率
- 实现请求级别的缓存机制
- 批量检索API减少模型调用次数
- 指数级回退的重试机制

## 系统扩展

系统设计为模块化架构，可以通过以下方式扩展:

1. 新增智能代理: 在 `_agents`目录下创建新的代理模块
2. 添加新工具: 在 `_tools`目录下添加新的工具功能
3. 扩展API: 在 `api`目录下添加新的API接口
4. 自定义工作流: 修改 `_workflow/_work.py`定义新的工作流程
